<html>
    <head>
        <script src=/api/client></script>
    </head>
    <body>
        <script>

            // window.LOG_LEVEL = 'trace';

            MeshClient('localhost', 'mesh', function(e, client) {

                if (e) return console.error(e);

                var accum = '';

                window.client = client; // for browser console access to client


                // Mesh Exchange Api is ok?

                client.exchange.www.example({true: 'YES', false: 'NO'})

                .then(function(result) {
                    console.log('exchange is working?', result);
                    accum += 'exchange is working? ' + result + '<br/><br/>';
                    document.body.innerHTML = accum;
                })

                .catch(function(error) {
                    console.error(error);
                });



                // Mesh Event 'expr' Api is ok?

                var first1 = true;
                client.event.www.on('ping', function(data, meta) {
                    if (first1) {
                        first1 = false;
                        console.log('event (expr) is working?', 'YES');
                        accum += 'event (expr) is working? YES<br/><br/>';
                        document.body.innerHTML = accum;
                        // console.log('data', data);
                        // console.log('meta', meta);
                    }
                });



                // Mesh Event 'expr*' Api is ok?

                var first2 = true;
                var received = {};
                client.event.www.on('wildcard/*', function(data, meta) {
                    if (first2) {
                        received[meta.path] = data;
                    }
                    if (first2 && Object.keys(received).length > 1) {
                        first2 = false;
                        console.log('event (expr*) is working?', 'YES');
                        accum += 'event (expr*) is working? YES<br/><br/>';
                        document.body.innerHTML = accum;
                        // console.log('data', data);
                        // console.log('meta', meta);
                    }
                });


                // Local (inclient) events

                client.on('create/components', function(components) {
                    console.log('create/components', components);
                    accum += 'created components - ' + components.map(function(comp) {
                        return comp.description.name
                    }).join(' ') + '<br/><br/>'
                });

                client.on('destroy/components', function(components) {
                    console.log('destroy/components', components);
                    accum += 'destroyed components - ' + components.map(function(comp) {
                        return comp.description.name
                    }).join(' ') + '<br/><br/>'
                });

                client.start();

            });

        </script>
    </body>
</html>